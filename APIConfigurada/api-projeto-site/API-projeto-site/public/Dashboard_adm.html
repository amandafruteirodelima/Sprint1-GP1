<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/headerDark.css">
    <link rel="stylesheet" href="css/Dash_adm.css">
    <link rel="icon" href="img/Yin-Yang-DevTime.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.2.0/chart.min.js"
        integrity="sha512-VMsZqo0ar06BMtg0tPsdgRADvl0kDHpTbugCBBrL55KmucH6hP9zWdLIWY//OTfMnzz6xWQRxQqsUFefwHuHyg=="
        crossorigin="anonymous"></script>
    <title>Dashboard</title>
</head>

<body>
    <!--Início Header-->
    <div class="divHeader">

        <div class="container-header">

            <div class="divImagem"><img src="./img/Logo-Branco.png" alt="Logo DevTime"></div>

            <nav class="divLista">
                <ul>
                    <li><a class="li-select" href="Dashboard_adm.html">Dashboard</a></li>
                    <li><a class="li-comum" href="Cadastro_equipe.html">Equipes</a></li>
                    <li><a class="li-comum" href="Cadastro.html">Cadastro</a></li>
                    <li><a class="li-comum" href="Dashboard_selecao_componentes.html">Componentes</a></li>
                </ul>
            </nav>
            <div class="divButton"><button><a class="li-comum" href="Login.html">Sair</a></button></div>
        </div>
    </div>

    <!--Fim Header-->

    <!-- Início da página -->
    <h1 id="h1_1">BEM-VINDO</h1>

    <!-- Membros online -->
    <h2>Membros da equipe que estão online agora</h2>

    <div id="div_online" class="div_online">

    </div>

    <!-- Divisória -->
    <div class="div_divisora"></div>

    <!-- Desempenho equipe -->
    <div class="organizadora">
        <h2 id="h2_alt" class="h2_alt">Desempenho dos membros da equipe</h2>
        <img onclick="mudar_frase()" class="question" src="img/question.png" alt="question icon">
    </div>

    <div id="div_desempenho_pai" class="div_desempenho_pai">

    </div>

    <!-- Desempenho equipe (quando clicado) -->
    <div id="div_desempenho_pai_alternativa" style="display: none;" class="div_desempenho_pai_alternativa">

        <div class="organizadora_title_alternativa">

            <img id="desempenho_go_back" onclick="go_back()" class="desempenho_go_back" src="img/seta.png" alt="">

            <h2 class="alt_title">Detalhes da produtividade de: </h2>

            <img class="invisible" src="img/seta.png">

        </div>

        <h2 id="h2_nome" class="alt_title2"></h2>

        <div id="div_options" class="div_options">

            <div class="div_option_content" onclick="tempo_logado()">

                <h2 class="alt_title3">Ver tempo logado na máquina</h2>
                <img class="img_option" src="img/time-left.png">

            </div>

            <div class="div_option_content" onclick="aplicativos_usados()">

                <h2 class="alt_title3">Ver aplicativos usados na máquina</h2>
                <img class="img_option" src="img/apps.png">

            </div>

        </div>

        <!-- Desempenho equipe (quando clicado) / Tempo Logado -->
        <div class="div_options" id="div_tempo_logado" style="display: none;">

            <div class="box_horas_usadas_hoje">

                <h2 class="tempo_usado" style="margin-bottom: 15%;">Tempo usado hoje</h2>

                <div class="organizadora">

                    <h2 id="tempo_usado_hoje" class="tempo_usado2">0 horas</h2>

                </div>
            </div>

            <div class="box_horas_usadas_quinze">

                <h2 class="tempo_usado">Tempo usado nos últimos quinze dias</h2>

                <div class="organizadora_overflow">

                    <h2 id="tempo_usado_1_dia_atras" class="tempo_usado4">Ontem: 0 horas</h2>
                    <h2 id="tempo_usado_2_dia_atras" class="tempo_usado4">2 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_3_dia_atras" class="tempo_usado4">3 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_4_dia_atras" class="tempo_usado4">4 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_5_dia_atras" class="tempo_usado4">5 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_6_dia_atras" class="tempo_usado4">6 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_7_dia_atras" class="tempo_usado4">7 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_8_dia_atras" class="tempo_usado4">8 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_9_dia_atras" class="tempo_usado4">9 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_10_dia_atras" class="tempo_usado4">10 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_11_dia_atras" class="tempo_usado4">11 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_12_dia_atras" class="tempo_usado4">12 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_13_dia_atras" class="tempo_usado4">13 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_14_dia_atras" class="tempo_usado4">14 dias atrás: 0 horas</h2>
                    <h2 id="tempo_usado_15_dia_atras" class="tempo_usado4">15 dias atrás: 0 horas</h2>

                </div>
            </div>
        </div>

        <!-- Desempenho equipe (quando clicado) / Aplicativos Usados -->

        <div id="div_aplicativos_usados" class="div_tempo_logado" style="display: none;">

            <!-- Divisória -->
            <div class="div_divisora_alt" id="div_divisora_alt3"></div>

            <div class="div_data">
                <h2 class="alt_title3">Aplicativos usados hoje:</h2>

                <div class="organizadora_alt2">

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/Apache_NetBeans.png">
                        <h4 class="alt_title5">2h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/vs-code.png">
                        <h4 class="alt_title5">4h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/chrome.png">
                        <h4 class="alt_title5">0.4h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/Microsoft_Office_Teams.png">
                        <h4 class="alt_title5">5h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/spotify.png">
                        <h4 class="alt_title5">2h</h4>
                    </div>

                </div>
            </div>

            <!-- Divisória -->
            <div class="div_divisora_alt"></div>

            <div class="div_data">

                <h2 class="alt_title3">Aplicativos usados na semana:</h2>

                <div class="organizadora_alt2">

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/Apache_NetBeans.png">
                        <h4 class="alt_title5">10h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/vs-code.png">
                        <h4 class="alt_title5">12h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/chrome.png">
                        <h4 class="alt_title5">4h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/youtube.png">
                        <h4 class="alt_title5">2h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/Microsoft_Office_Teams.png">
                        <h4 class="alt_title5">25h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/spotify.png">
                        <h4 class="alt_title5">10h</h4>
                    </div>

                </div>
            </div>

            <!-- Divisória -->
            <div class="div_divisora_alt"></div>

            <div class="div_data">
                <h2 class="alt_title3">Aplicativos usados na quinzena</h2>

                <div class="organizadora_alt2">

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/Apache_NetBeans.png">
                        <h4 class="alt_title5">20h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/vs-code.png">
                        <h4 class="alt_title5">30h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/chrome.png">
                        <h4 class="alt_title5">8h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/youtube.png">
                        <h4 class="alt_title5">3h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/Microsoft_Office_Teams.png">
                        <h4 class="alt_title5">45h</h4>
                    </div>

                    <div class="quadrado3">
                        <img class="img_quadrado" src="img/spotify.png">
                        <h4 class="alt_title5">14h</h4>
                    </div>

                </div>
            </div>

        </div>


    </div>

</body>

</html>

<script>
    // Código sendo preparado para receber APIs

    // NOVAS COISAS
    var idFuncionario = sessionStorage.getItem('idFuncionario');

    function tempo_logado() {
        div_options.style.display = "none";
        div_tempo_logado.style.display = "flex";
    }

    function aplicativos_usados() {
        div_options.style.display = "none";
        div_aplicativos_usados.style.display = "block";
    }

    // NOVAS FUNCTIONS
    window.onload = function online() {

        bemvindoNome();
        trazerFuncionariosOnline();
        trazerFuncionariosOnlineCard();

        // ok = "img/checked.png";
        // notOk = "img/warning.png";
        // check_1.src = ok;
        // check_2.src = ok;
        // check_3.src = ok;
        // check_4.src = ok;
        // check_5.src = notOk;
        // check_6.src = notOk;
    }


    cont = 0;

    function mudar_frase() {
        if (cont == 0) {
            h2_alt.style.fontSize = "18px";
            h2_alt.innerHTML =
                "Desempenho dos membros da equipe (Para ver detalhes, clique no ícone do membro da equipe desejado)";
            cont++;
        } else {
            h2_alt.style.fontSize = "24px";
            h2_alt.innerHTML = "Desempenho dos membros da equipe";
            cont--;
        }
    }

    function abrir_info(nomeFuncionario) {

        div_desempenho_pai_alternativa.style.display = "block";

        h2_nome.innerHTML = `${nomeFuncionario}`;

    }

    // Seta (voltar)
    function go_back() {
        div_options.style.display = "flex";
        div_tempo_logado.style.display = "none";
        div_aplicativos_usados.style.display = "none";
    }

    // NOVAS FUNCTIONS
    function bemvindoNome() {
        h1_1.innerHTML = `BEM-VINDO ${sessionStorage.getItem('nome').toUpperCase()}`;

    }

    function trazerFuncionariosOnline() {

        fetch(`/usuarios/verOnline/${idFuncionario}`, {
            method: "post"
        }).then(resposta => {

            if (resposta.ok) {

                resposta.json().then(json => {

                    console.log(json);

                    //Mostrar cada funcionário na tela

                    for (let index = 0; index < json.length; index++) {

                        div_online.innerHTML += `<div class="div_online_content">
                        <h3>${json[index].nomeFuncionario}</h3>
                        <div class="circulo" id="circulo${json[index].idFuncionario}"></div>
                        </div>`;

                    }

                });

            } else {
                alert('Você não possui funcionários para monitorar');
            }
        });

        return false;

    }

    function onlineVerdeVermelho(idFuncionario) {

        fetch(`/usuarios/onlineVerdeVermelho/${idFuncionario}`, {
            method: "post"
        }).then(resposta => {

            if (resposta.ok) {

                resposta.json().then(json => {

                    console.log(json);

                    document.getElementById(`circulo${idFuncionario}`).style.backgroundColor =
                        "#00FB00";

                });

            }
        });

        return false;

    }

    function mostrarHorasUsadasHoje(idFuncionario) {

        fetch(`/usuarios/mostrarHorasUsadasHoje/${idFuncionario}`, {
            method: "post"
        }).then(resposta => {

            if (resposta.ok) {

                resposta.json().then(json => {

                    console.log(json.length);

                    // não precisa de "for", pois o for está na outra function

                    var minutos = json.length;

                    if ((minutos / 60) < 1) {

                        tempo_usado_hoje.innerHTML = `${minutos} minutos`;

                    } else if (minutos / 60 >= 1) {

                        var horas = parseInt(minutos / 60);
                        var minutosRestantes = (minutos % 60);

                        tempo_usado_hoje.innerHTML = `${horas} hora(s) e ${minutosRestantes} minutos`;
                    }

                });

            }
        });

        return false;

    }

    // Mostrar as horas usadas ontem
    function mostrarHorasUsadasOntem(idFuncionario) {

        fetch(`/usuarios/mostrarHorasUsadasOntem/${idFuncionario}`, {
            method: "post"
        }).then(resposta => {

            if (resposta.ok) {

                resposta.json().then(json => {

                    console.log(json.length);

                    // não precisa de "for", pois o for está na outra function

                    var minutos = json.length;

                    if ((minutos / 60) < 1) {

                        tempo_usado_1_dia_atras.innerHTML = `Ontem: ${minutos} minutos`;

                    } else if (minutos / 60 >= 1) {

                        var horas = parseInt(minutos / 60);
                        var minutosRestantes = (minutos % 60);

                        tempo_usado_1_dia_atras.innerHTML =
                            `Ontem: ${horas} hora(s) e ${minutosRestantes} minutos`;
                    }

                });

            }
        });

        return false;

    }

    // Mostrar as horas usadas 2 dias atrás
    function mostrarHorasUsadas2DiasAtras(idFuncionario) {

        fetch(`/usuarios/mostrarHorasUsadas2DiasAtras/${idFuncionario}`, {
            method: "post"
        }).then(resposta => {

            if (resposta.ok) {

                resposta.json().then(json => {

                    console.log(json.length);

                    // não precisa de "for", pois o for está na outra function

                    var minutos = json.length;

                    if ((minutos / 60) < 1) {

                        tempo_usado_2_dia_atras.innerHTML = `2 dias atrás: ${minutos} minutos`;

                    } else if (minutos / 60 >= 1) {

                        var horas = parseInt(minutos / 60);
                        var minutosRestantes = (minutos % 60);

                        tempo_usado_2_dia_atras.innerHTML =
                            `2 dias atrás: ${horas} hora(s) e ${minutosRestantes} minutos`;
                    }

                });

            }
        });

        return false;

    }

    function trazerFuncionariosOnlineCard() {

        fetch(`/usuarios/verOnline/${idFuncionario}`, {
            method: "post"
        }).then(resposta => {

            if (resposta.ok) {

                resposta.json().then(json => {

                    console.log(json);

                    //Mostrar cada funcionário na tela

                    for (let index = 0; index < json.length; index++) {

                        div_desempenho_pai.innerHTML += `<div onclick="abrir_info(this.id); mostrarHorasUsadasHojeGetter(${json[index].idFuncionario});" id="${json[index].nomeFuncionario}" class="div_desempenho_content">
                        <img id="check_1" class="check" src="img/checked.png" alt="">
                        <img class="person" src="img/userPink.png" alt="userPink.png icon">
                        <h3>${json[index].nomeFuncionario}</h3>
                        </div>`;

                        onlineVerdeVermelho(json[index].idFuncionario);

                    }

                });

            } else {
                alert('Você não possui funcionários para monitorar')
            }
        });

        return false;

    }

    // Ativa as horas usadas

    function mostrarHorasUsadasHojeGetter(namePego) {

        mostrarHorasUsadasHoje(namePego);
        mostrarHorasUsadasOntem(namePego);
        mostrarHorasUsadas2DiasAtras(namePego);
        // mostrarHorasUsadas3DiasAtras(namePego);
        // mostrarHorasUsadas4DiasAtras(namePego);
        // mostrarHorasUsadas5DiasAtras(namePego);
        // mostrarHorasUsadas6DiasAtras(namePego);
        // mostrarHorasUsadas7DiasAtras(namePego);
        // mostrarHorasUsadas8DiasAtras(namePego);
        // mostrarHorasUsadas9DiasAtras(namePego);
        // mostrarHorasUsadas10DiasAtras(namePego);
        // mostrarHorasUsadas11DiasAtras(namePego);
        // mostrarHorasUsadas12DiasAtras(namePego);
        // mostrarHorasUsadas13DiasAtras(namePego);
        // mostrarHorasUsadas14DiasAtras(namePego);
        // mostrarHorasUsadas15DiasAtras(namePego);
    }
</script>